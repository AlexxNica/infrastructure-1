server {
	listen   80;

	root /home/web/firehol/master;
	access_log /var/log/nginx/firehol-access.log;
	error_log /var/log/nginx/firehol-error.log;
	index index.html index.htm;

	server_name firehol.org www.firehol.org master.firehol.org vps.firehol.org;

        if ($host ~* ^(www|master)\.firehol\.org) {
          rewrite ^(.*)$ http://firehol.org$1? permanent;
        }

	error_page 404 /404.html;
	location /404.html {
		internal;
	}

	location ~ /\.ht {
		deny all;
	}

        location /robots.txt { alias /home/web/firehol/static/robots.txt; }
        location /googleac3935750bab1075.html {
           alias /home/web/firehol/static/googleac3935750bab1075.html;
        }

        # Perma-URL in manual
        location /manual/latest {
          rewrite .* /manual permanent;
        }
        location /manual {
          # Until the new iframes+javascript version is live
          alias /home/web/firehol/download/unsigned/master/firehol-manual.html;
          default_type text/html;
          allow all;
        }

        location /firehol-manual.pdf {
           alias /home/web/firehol/download/unsigned/master/firehol-manual.pdf;
           allow all;
        }
        location /firehol-manual.html {
           alias /home/web/firehol/download/unsigned/master/firehol-manual.html;
           allow all;
        }
        location /firehol-manual.css {
           alias /home/web/firehol/download/unsigned/master/firehol-manual.css;
           allow all;
        }
        location /firehol-services.html {
           alias /home/web/firehol/download/unsigned/master/firehol-services.html;
           allow all;
        }

        location /firehol-manual {
           alias /home/web/firehol/download/unsigned/master/html;
           allow all;
	}

        location /webalizer {
		alias /home/web/firehol/webalizer;
		allow all;
	}

        location /download {
		alias /home/web/firehol/download;
		allow all;
		autoindex on;
	}

	# Redirects from old site
        location /services.html {
          rewrite .* /services permanent;
	}
        location /commands.html {
          rewrite .* /firehol-manual.html permanent;
	}
        location /support.html {
          rewrite .* /getting-help permanent;
	}
        location /adding.html {
          rewrite .* /firehol-manual.html#adding-services permanent;
	}
        location /overview.html {
          rewrite .* / permanent;
	}
        location /overview {
          rewrite .* / permanent;
	}
        location /faq.html {
          rewrite .* /faq permanent;
	}
        location /tutorial.html {
          rewrite .* /tutorial permanent;
	}
        location /documentation/ {
          rewrite .* /tutorial permanent;
	}
        location /firehol.conf {
          rewrite .* /firehol-manual.html#firehol.conf permanent;
	}
        location /trouble.html {
          rewrite .* /troubleshooting permanent;
	}
        location /invoking.html {
          rewrite .* /firehol-manual.html#firehol permanent;
	}

	location /github-hook.php {
		alias /home/firehol/web/github-hook.php;
		fastcgi_pass  unix:/var/run/php-fpm.sock;
		include       fastcgi_params;
	}
}
