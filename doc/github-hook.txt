                           GitHub Hooks
                           ************

GitHub Configuration
====================
Under the github repository settings, add a webhook URL:
        http://firehol.org/github-hook.php


Server configuration
====================
Only repositories and branches that are listed will be built automatically
(since only branches that the scripts understand how to build can be used).

cat - > /etc/firehol-build.conf <<- END
	# Format:
	#   repo branch script-to-run [override-target]
	# The same repo may be used multiple times to allow multiple branches
	# The special branch 'tag' applies to any tag
	https://github.com/firehol/firehol.git tag /home/firehol/bin/process-firehol-tgz
	https://github.com/firehol/firehol.git master /home/firehol/bin/process-firehol-tgz master
	https://github.com/firehol/firehol.git stable-v2 /home/firehol/bin/process-firehol-tgz
	https://github.com/firehol/website.git master /home/firehol/bin/process-firehol-website www
	https://github.com/firehol/website.git test /home/firehol/bin/process-firehol-website test
	END


Nginx Configuration
===================
Add the following to the nginx server configuration:

	location /github-hook.php {
		alias /home/firehol/web/github-hook.php;
		fastcgi_pass  unix:/var/run/php-fpm.sock;
		include       fastcgi_params;
	}

The PHP script parses the incoming JSON and creates build instructions
in web/requests which are acted on by a cron-job.


Cron configuration
==================
Add the following to the firehol user's crontab:
  * * * * * /home/firehol/bin/process-requests > /dev/null 2> /dev/null


Appendix
========
Commit hooks:
  https://help.github.com/articles/post-receive-hooks

Handy for debugging:
  http://requestb.in/

  e.g. curl -X POST -d "fizz=buzz" http://requestb.in/1j5898a1
       firefox http://requestb.in/1j5898a1?inspect
